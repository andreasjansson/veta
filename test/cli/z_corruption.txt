===
setup - add a note first
===
veta add --title "Test note" --tags "test" --body "Test content"
---
Added note {{ id }}
---
where
* id > 0

===
corrupt the database
===
echo "garbage data that is definitely not sqlite" > .veta/db.sqlite
echo "corrupted"
---
corrupted

===
detect corruption and backup corrupted file
===
veta ls 2>&1 ; echo "exit: $?"
---
Warning: Database corruption detected. Attempting recovery...
Error: Database is corrupted and could not be recovered.
The corrupted file has been moved to: {{ path }}
Run 'veta init' to create a new database.
exit: 1
---
where
* path endswith "db.sqlite.corrupted"

===
verify corrupted file was backed up
===
test -f .veta/db.sqlite.corrupted && echo "backup exists"
---
backup exists

===
verify original db was removed
===
test ! -f .veta/db.sqlite && echo "original removed"
---
original removed

===
can reinitialize after corruption
===
veta init
---
Initialized veta database in .veta/db.sqlite

===
verify new database works
===
veta add --title "Fresh note" --tags "new" --body "After corruption"
---
Added note 1

====
verify note was saved
====
veta show 1
----
# Fresh note

After corruption

---

Last modified: {{ modified }}
Tags: new
