%platform unix

=====
reinitialize and add a note first
=====
veta init --reinitialize
veta add --title "Test note" --tags "test" --body "Test content"
-----
Reinitialized veta database in .veta
Added note 1

=====
corrupt a note file
=====
echo "garbage data that is not json" > .veta/notes/1.json
echo "corrupted"
-----
corrupted

=====
detect corruption when showing note
=====
veta show 1 2>&1 ; echo "exit: $?"
-----
Error: database error: Failed to parse note: {{ msg }}
exit: 1
-----
where
* msg contains "expected"

=====
can still list notes (shows nothing since note is corrupt)
=====
veta ls 2>&1 ; echo "exit: $?"
-----
Error: database error: Failed to parse note: {{ msg }}
exit: 1
-----
where
* msg contains "expected"

=====
can reinitialize after corruption
=====
veta init --reinitialize
-----
Reinitialized veta database in .veta

=====
verify new database works
=====
veta add --title "Fresh note" --tags "new" --body "After corruption"
-----
Added note 1

=====
verify note was saved
=====
veta show 1
-----
# Fresh note

After corruption

---

Last modified: {{ modified }}
Tags: new
